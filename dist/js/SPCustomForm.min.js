/*! spcustomform 2017-09-15 */

!function(t,e,a,i){t.fn.formify=function(i){function n(){var e,a=s.find(".spLabel"),i=(a.length,[{title:c.listTitle,width:500},{title:(new Date).toLocaleDateString(),width:500}]),n=[],l=[],d=0,r=function(a){var i=a.attr("data-internal-fieldname");U("internalName"+i);var n=String(a.attr("data-fieldtypekind")),r=s.find(".spControl[data-internal-fieldname='"+i+"']");if("2"===n||"4"===n||"9"===n||"10"===n){if(r.find("input").length>0)return r.find("input").val()}else if("6"===n||"7"===n&&r.find("select").length>0){if(r.find("select").length>0)return r.find("select option:selected").text();if(r.find("input[type='radio']").length>0)return r.find("input[type='radio']:checked").val()}else if("3"===n){if(r.find("textarea").length>0)return r.find("textarea").val();if(r.find("span").length>0){var o=r.clone();return o.find(".no-content").remove(),e=o.find("img").each(function(){d++,t(this).after(" (SEE FIGURE "+d+") "),l.push(t(this).attr("src"))}),t.trim(t("<div>").html(o.html()).text()).replace(/[^\u0000-\u007E]/g,"")}}else if("15"===n||"8"===n||"7"===n&&r.find("button").length>0){if(r.find("input").length>0)return"15"===n||"8"===n?r.find("input:checkbox:checked").map(function(){return this.value}).get():r.find("input:checkbox:checked").map(function(){return t(this).attr("data-text")}).get()}else if("20"===n)return r.find(".ms-entity-resolved").length>0?r.find(".ms-entity-resolved").map(function(){return t(this).text()}).get().join(","):"";return r.text()};U("labels.le "+a.length),M(a);var o=new jsPDF;if(a.each(function(){var e=t(this).text(),a=t.trim(r(t(this)))||"";e&&e.length>35&&(e=e.substring(0,35)),U(" text:"+e+" val:"+a),n.push([e,a])}),U("data"),M(n),o.autoTable(i,n,{theme:"grid",styles:{lineWidth:.01,lineColor:0,fillStyle:"DF",valign:"middle",overflow:"linebreak"},columnStyles:{0:{columnWidth:60},1:{columnWidth:120}}}),l&&l.length>0){U(l);for(var u=0;u<l.length;u++){var f=new Image;f.crossOrigin="",f.src=l[u],f.myText=u+1,f.onload=function(){o.addPage(),o.text(15,15,"figure "+this.myText+" "),o.addImage(this,0,20),0==--d&&o.save("SPPDF.pdf")}}}else o.save("SPPDF.pdf")}var l,d,r,s=this,o={},u={},c=t.extend({web:_spPageContextInfo.webServerRelativeUrl,displayArray:[],hiddenFields:[],lang:_spPageContextInfo.currentLanguage,includeControls:!0,modalHtml:""},i),f={};1036===c.lang?(f.deleteItem="Supprimer ",f.cannotSave="Le formulaire ne peut pas Ãªtre sauvegardÃ©. <br>Les champs obligatoires suivants sont vides :",f.uploadFile="Impossible de tÃ©lÃ©charger un fichier!",f.savedAll="Enregistré tous",f.exitWithoutSaving="Quitter sans enregistrer?",f.exit="Quitter",f.save="Enregistrer",f.saveAndExit="Sauvegarder et quitter",f.printToPDF="Imprimer au format pdf",f.edit="Modifier"):(f.deleteItem="Delete ",f.cannotSave="Form cannot be saved.<br>The following required fields are empty:",f.uploadFile="Failed to upload a file!",f.savedAll="Saved all",f.exitWithoutSaving="Exit without saving?",f.exit="Exit",f.save="Save",f.saveAndExit="Save and Exit",f.printToPDF="Print to PDF",f.edit="Edit");var p=function(t,e){var a={};a.PrincipalAccountType="User,DL,SecGroup,SPGroup",a.SearchPrincipalSource=15,a.ResolvePrincipalSource=15,a.AllowMultipleValues="User"!==e,a.MaximumEntitySuggestions=50,a.Width="100%",this.SPClientPeoplePicker_InitStandaloneControlWrapper(t,null,a)},m=function(e,a){t.each(e,function(t,i){h(i.Title,a+"Id",e)})},h=function(e,a){a=a.substring(0,a.length-2);var i=t("[title='"+a+"']").find(".sp-peoplepicker-topLevel").attr("id"),n=SPClientPeoplePicker.SPClientPeoplePickerDict[i];n.AddUserKeys(e,!1),n.AddUnresolvedUserFromEditor(!0)},v=function(){var e=[];e.push(_spPageContextInfo.webServerRelativeUrl+"/"+_spPageContextInfo.layoutsUrl+"/iframe.aspx?"),e.push("&cal=1"),e.push("&lcid=1033"),e.push("&langid=1033"),e.push("&tz=-08:00:00.0002046"),e.push("&ww=0111110"),e.push("&fdow=0"),e.push("&fwoy=0"),e.push("&hj=0"),e.push("&swn=false"),e.push("&minjday=109207"),e.push("&maxjday=2666269"),e.push("&date="),t('[field-type="DateTime"]').each(function(a){var i=t(this).attr("id");t(this).after('<iframe id="'+i+'DatePickerFrame" title="Select a date from the calendar." style="display:none; position:absolute; width:200px; z-index:101;" src="/_layouts/15/images/blank.gif?rev=23"></iframe>'),t(this).after('<a href="#" style="vertical-align:top;"><img id="'+i+'DatePickerImage" border="0" alt="Select a date from the calendar." src="/_layouts/15/images/calendar_25.gif?rev=23"></a>'),t(this).next("a").on("click",function(){return clickDatePicker(i,e.join(""),"",event),!1})})},g=function(t){var e,a;return t&&-1!==t.indexOf("T")?(e=t.split("T")[0],a=e.split("-"),new Date(a[0],Number(a[1]-1),Number(a[2]))):t},b=function(t){var e,a,i;return t?(e=String(t.getDate()),e="0"+e,e=e.slice(-2),a=String(t.getMonth()+1),a="0"+a,a=a.slice(-2),i=t.getFullYear(),a+"/"+e+"/"+i):t},y=function(t){var e="";return e+=t.getFullYear()+"-",e+=("0"+(t.getMonth()+1)).slice(-2)+"-",e+=("0"+t.getDate()).slice(-2)+"T",e+=("0"+t.getHours()).slice(-2)+":",e+=("0"+t.getMinutes()).slice(-2)+":",e+=("0"+t.getSeconds()).slice(-2)+"Z"},T=function(t){var e;return-1!==t.indexOf("/")?(e=t.split("/"),new Date(e[2],Number(e[0]-1),Number(e[1]))):t},x=function(e){return t.ajax({url:e,type:"GET",dataType:"json",headers:{Accept:"application/json;odata=verbose"}})},I=function(e,a){return t.ajax({url:e,type:"POST",contentType:"application/json;odata=verbose",data:a,headers:{accept:"application/json;odata=verbose","X-RequestDigest":t("#__REQUESTDIGEST").val(),"IF-MATCH":"*","X-Http-Method":"MERGE"}})},F=function(e,a){return t.ajax({url:e,type:"POST",contentType:"application/json;odata=verbose",data:a,headers:{accept:"application/json;odata=verbose","X-RequestDigest":t("#__REQUESTDIGEST").val()}})},S=function(t,e,a,i){var n=s.find(".confirmModal");n.find(".confirmModalLabel").html(t),n.find(".confirm, .cancel").off("click"),n.find(".cancel").show(),i&&n.find(".cancel").hide(),e&&n.find(".confirm").on("click",e),a&&n.find(".cancel").on("click",a)},k=function(){var i="";if(c.htmlData?s.append(c.modalHtml+c.htmlData):i=c.modalHtml+"<div class='myContainer' data-guid='"+c.listGuid+"' data-listMetadata='"+r+"'><table class='table table-hover'>",U("displayArray "+c.displayArray),t.each(l,function(t,e){var a,n="",l=!1;if(-1!==c.hiddenFields.indexOf(e.InternalName))return!0;U("in  "+e.InternalName+" "+c.displayArray.indexOf(e.InternalName)),c.isEditForm&&-1==c.displayArray.indexOf(e.InternalName)&&(l=!0),e.Hidden||e.ReadOnlyField||12===e.FieldTypeKind||(U("isEdit "+l+" "+e.InternalName),l&&e.SchemaXml&&(schema=e.SchemaXml,schema=schema.replace(/\\/g,""),schema=jQuery.parseXML(schema),e.jsonS=O(schema),n=j(e)),c.htmlData?(a=function(t){return 20==t||7==t||19==t?"Id":""}(e.FieldTypeKind),s.find(".spLabel[data-internal-fieldname='"+e.InternalName+a+"']").attr("data-fieldtypekind",e.FieldTypeKind).html(e.Title+" "+(e.Required?"<span>*</span>":"")),s.find(".spControl[data-internal-fieldname='"+e.InternalName+a+"']").attr("data-isedit",l).html(n)):i+="<tr><td class='col-md-6 spLabel' data-fieldTypeKind='"+e.FieldTypeKind+"' data-internal-fieldName='"+e.InternalName+"'>"+e.Title+" "+(e.Required?"<span>*</span>":"")+"</td><td class='col-md-6 spControl' data-internal-fieldName='"+e.InternalName+"' data-isedit='"+l+"'>"+n+"</td></tr>")}),c.includeControls){var n=c.scriptFolder+"img/paperclip.png";c.htmlData?s.find(".paperclip").attr("src",n):(i+="<tr><td class='col-md-6'></td><td class='col-md-6'>\x3c!--button type='button' class='btn btn-default testButton'>Test</button--\x3e<button type='button' class='btn btn-default pdfButton'>"+f.printToPDF+"</button><button type='button' class='btn btn-default cancelButton'>"+f.exit+"</button>",c.isEditForm?i+="<button type='button' class='btn btn-default saveButton'>"+f.save+"</button><button type='button' class='btn btn-default saveAndExitButton'>"+f.saveAndExit+"</button><div class='attachmentsContainer'><img class='paperclip' src='"+n+"'>":i+="<button type='button' class='btn btn-default editButton'>"+f.edit+"</button>",i+="<input class='myAttachments' style='display:none;' type='file' fileread='run.AttachmentData' fileinfo='run.AttachmentInfo' /><div class='attachments'></div></div>")}t(e).ready(function(){U("window.location.pathname "+a.location.pathname),c.htmlData||s.append(i+"</table></div>"),t("#DeltaPlaceHolderPageTitleInTitleArea").find("a").eq(1).text(c.listTitle||"No Name provided"),P(),c.itemId?(R(),w()):L(),_(),s.fadeIn()})},w=function(){var t="",e=c.scriptFolder+"img/delete.png";if(d.AttachmentFiles.results&&d.AttachmentFiles.results.length>0){for(var a=0;a<d.AttachmentFiles.results.length;a++)t+="<div><a target='_blank' href='"+d.AttachmentFiles.results[a].ServerRelativeUrl+"'>"+d.AttachmentFiles.results[a].FileName+"</a><span class='deleteAttachment' style='margin-left:10px;' data-file='"+d.AttachmentFiles.results[a].FileName+"'><img src='"+e+"'></span></div>";s.find(".attachments").append(t)}},N=function(t){return"Invalid Date"!==new Date(t)&&!isNaN(new Date(t))},A=function(e){var i={},n={},l=[],d=[],o=[],p="";s.find(".sp-peoplepicker-userSpan").each(function(){var e=t(this).attr("sid"),a=(e=e.replace("span","")).split("\\"),r=encodeURIComponent(a[0]+"\\"+a[1]),s=(t(this).closest(".customField").attr("data-internal"),t(this).closest(".customField").attr("data-kind")),u=t(this).closest(".customField").attr("data-internal");if("User"===s?i[u]=e:"UserMulti"===s&&(n[u]?n[u].push(e):n[u]=[e]),-1==l.indexOf(r)){l.push(r);var f=c.web+"/_api/web/siteusers?&$filter=LoginName%20eq%20%27"+r+"%27";d.push(x(f).done(function(t){t.d.results[0]&&o.push(t.d.results[0])}))}}),t.when.apply(t,d).done(function(){function i(t){for(var e="",a=0;a<o.length;a++)if(o[a].Title==t){e=o[a].Id;break}return e}function n(e,a,n){var l,d,r,s,o;if("single"===a)return e.find("input").val();if("number"===a)return parseFloat(e.find("input").val());if("radioButtons"===a)return e.find("input:checked").val();if("dropdown"===a)return e.find("select").val();if("dateTime"===a)return e.find("input").val()?y(T(e.find("input").val())):null;if("boolean"===a)return e.find("input").is(":checked");if("multiText"===a)return e.find("textarea").val();if("multiTextEnhanced"===a)return e.find(".DCContent").html();if("checkBoxes"===a)return l={__metadata:{type:"Collection(Edm.String)"},results:[]},e.find("input:checked").each(function(){l.results.push(t(this).val())}),l;if("lookup"==a){if("true"===e.attr("data-allowMultipleValues")){if(e.find(".multiLookup").attr("data-text"),d=e.find(".multiLookup").attr("data-id"),l={__metadata:{type:"Collection(Edm.Int32)"},results:[]},d){if(-1!=d.indexOf(";")){(r=d.split(";")).pop();for(var u=0;u<r.length;u++)r[u]=+r[u];return l.results=r,l}return l.results.push(Number(d)),l}return l}return(d=Number(e.find("select").val()))?d:null}return"multiTextEnhanced"==a?e.find("[role='textbox']").eq(1).html():"multiText"==a?e.find("textarea").val():"pplPicker"==a?(s=e.attr("data-kind"),o=e.find(".ms-entity-resolved"),"UserMulti"==s?(l={__metadata:{type:"Collection(Edm.Int32)"},results:[]},o.each(function(){id=i(t(this).attr("title")),id&&l.results.push(id)}),l):o?(id=i(o.attr("title")),id||null):null):null}var l={__metadata:{type:r}};if(s.find(".customField").each(function(){var e=t(this).attr("name"),a=t(this).attr("data-internal"),i=t(this).attr("data-required"),d=n(t(this),e);U(e+" "+a+" "+d),l[a]=d,"true"!=i||d||(p+="- "+a+"<br>")}),p)S(f.cannotSave+p,function(){s.find(".confirmModal").modal("hide")},null,!0),s.find(".confirmModal").modal("show");else{var d=c.web+"/_api/Web/Lists(guid'"+c.listGuid+"')/items";c.itemId?(d+="("+c.itemId+")",I(d,JSON.stringify(l)).done(function(t){U("updated!"+JSON.stringify(t)+" x "+e+" "+c.goHereAfterSave),e&&c.goHereAfterSave?(U("gon updated!"+JSON.stringify(t)+" "+e+" "+c.goHereAfterSave),a.location=c.goHereAfterSave):(S(f.savedAll,function(){s.find(".confirmModal").modal("hide")},null,!0),s.find(".confirmModal").modal("show"))}).fail(function t(){U("failed to save existing item "+JSON.stringify(t))})):F(d,JSON.stringify(l)).done(function(t){if(U("created "+JSON.stringify(t)),c.itemId=t.d.Id,u&&Object.keys(u).length>0)for(var e in u)D(u[e],!0)}).fail(function(t){U("failed to save new item "+JSON.stringify(t))})}})},E=function(e){var a=e.attr("data-file");U("file "+a),M(e),c.itemId?a&&t.ajax({url:c.web+"/_api/web/lists(guid'"+c.listGuid+"')/getItemById("+c.itemId+")/AttachmentFiles/getByFileName('"+a+"')",method:"DELETE",headers:{"X-RequestDigest":t("#__REQUESTDIGEST").val()}}).done(function(t){e.closest("div").remove()}).fail(function(t){alert("failed to delete file "+JSON.stringify(t))}):e.closest("div").remove()},D=function(i,n){(function(e){var a=t.Deferred(),i=new FileReader;return i.onload=function(t){a.resolve(t.target.result)},i.onerror=function(t){a.reject(t.target.error)},i.readAsArrayBuffer(e),a.promise()})(i).then(function(l){t.ajax({url:_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists(guid'"+c.listGuid+"')/items("+c.itemId+")/AttachmentFiles/add(FileName='"+i.name+"')",method:"POST",data:l,processData:!1,headers:{Accept:"application/json; odata=verbose","content-type":"application/json; odata=verbose","X-RequestDigest":e.getElementById("__REQUESTDIGEST").value,"content-length":l.byteLength}}).done(function(t){if(n){u[i.name].uploaded=!0;var e=!0;for(var l in u)u[l].uploaded||(e=!1);e&&(U("we are done uploading all files"),a.location=c.goHereAfterSave)}else{var d="<div><a target='_blank' href='#'>"+i.name+"</a><span class='deleteAttachment'  style='margin-left:10px;' data-file='"+i.name+"'><img src='"+c.scriptFolder+"img/delete.png'></span></div>";s.find(".attachments").append(d),s.find(".myAttachments").hide()}}).fail(function(t){alert(f.uploadFile+JSON.stringify(t))})})},_=function(){s.find(".paperclip").on("click",function(){U("p"),s.find(".myAttachments").toggle()}),s.find(".myAttachments").on("change",function(){U(".myAttachments "+c.itemId);var e=t(this)[0].files[0],a=c.scriptFolder+"/delete.png";c.itemId?D(e):u[e.name]||(u[e.name]=e,s.find(".attachments").append('<div class="newForm" data-name="'+e.name+'"><a href="#">'+e.name+'</a><span class="deleteAttachment" data-file="'+e.name+'" style="margin-left: 10px;"><img src="'+a+'"></span></div>'))}),s.find(".editButton").on("click",function(){a.location=e.URL+"&isEdit=true"}),s.find(".saveButton").on("click",function(){A()}),s.find(".saveAndExitButton").on("click",function(){A(!0)}),s.find(".pdfButton").on("click",function(){n()}),s.find(".cancelButton").on("click",function(){c.isEditForm?(S(f.exitWithoutSaving,function(){s.find(".confirmModal").modal("hide"),a.location=c.goHereAfterSave},null,!1),s.find(".confirmModal").modal("show")):a.location=c.goHereAfterSave}),s.find(".customField[name='dateTime']").find("input").on("change",function(){N(t(this).val())||t(this).val("")}),s.find(".testButton").on("click",function(){}),s.on("click",".multiLookup input",function(){var e=t(this).closest(".dropdown-menu").find("input:checked"),a=(t(this).closest(".dropdown-menu").attr("data-field"),""),i="";e.each(function(){a+=t(this).attr("data-text")+";",i+=t(this).attr("data-value")+";"}),t(this).closest(".dropdown-menu").attr("data-text",a).attr("data-id",i).closest(".spControl").find(".textValue").text(a)}),s.find(".attachments").on("click",".deleteAttachment",function(){var e=t(this);S(f.deleteItem+t(this).attr("data-file")+"?",function(){s.find(".confirmModal").modal("hide"),U("aattachment"),M(e),E(e)},null,!0),s.find(".confirmModal").modal("show")}),setInterval(function(){t.ajax({url:_spPageContextInfo.webAbsoluteUrl+"/_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"},success:function(e){t("#__REQUESTDIGEST").val(e.d.GetContextWebInformation.FormDigestValue)},error:function(t,e,a){alert(a)}})},6e5)},C=function(e,a,i,n){U("getLookUpData "+e+" "+a+" "+i+" "+n);var l="";if("false"===i)o[n]&&(l="<select class='form-control input-sm' data-field='"+e+"'>",t.each(o[n].results,function(t,a){l+="<option data-text='"+a[e]+"' value='"+a.Id+"'>"+a[e]+"</option>"}),s.find("[data-internal='"+a+"']").html(l+="</select>"),s.find("[data-internal='"+a+"']").find("select").val(d[a]));else if(o[n]){l='<div class="button-group"><button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu multiLookup" data-field="'+a+'">',t.each(o[n].results,function(t,a){l+='<li><input type="checkbox" data-text="'+a[e]+'" data-value="'+a.Id+'">&nbsp;'+a[e]+"</input></li>"}),s.find("[data-internal='"+a+"']").html(l+="</ul></div>");var r=(d[a]||{}).results,u="";if(r&&r.length>0){for(var c=0;c<r.length;c++)s.find("[data-internal='"+a+"']").find("input[data-value='"+r[c]+"']").prop("checked",!0),u+=s.find("[data-internal='"+a+"']").find("input[data-value='"+r[c]+"']").attr("data-text")+";";s.find("[data-internal='"+a+"']").closest(".spControl").find(".textValue").text(u)}}},P=function(){v();var e=s.find(".ppl"),a=s.find("span[name='lookup']"),i=s.find("[name='multiTextEnhanced']");a.each(function(e,a){var i=t(this).attr("data-allowMultipleValues"),n=t(this).attr("data-lookupField"),l=t(this).attr("data-lookupList"),d=t(this).attr("data-internal");C(n,d,i,l)}),e&&ExecuteOrDelayUntilScriptLoaded(function(){e.each(function(e,a){var i=t(this).attr("id"),n=t(this).closest(".customField").attr("data-kind");p(i,n)})},"sp.js"),i&&ExecuteOrDelayUntilScriptLoaded(function(){i.each(function(){t(this).spHtmlEditor()})},"sp.js")},R=function(){var e;s.find(".spControl").each(function(){var a,i,n,l,r,s,o,u,c;if("true"===t(this).attr("data-isedit")){if(a=t(this).find(".customField"),i=a.attr("name"),n=a.attr("data-internal"),"pplPicker"===i&&(n=n.substring(0,n.length-2),e=a.attr("data-kind")),l=d[n])if("single"===i||"number"===i)a.find("input").val(l);else if("radioButtons"===i)a.find("input[value='"+l+"']").prop("checked",!0);else if("dropdown"===i)a.find("select").val(l);else if("dateTime"===i)a.find("input").val(b(g(l)));else if("boolean"===i)a.find("input").prop("checked",!0);else if("checkBoxes"===i){r=l.results;for(var f=0;f<r.length;f++)a.find("input[value='"+r[f]+"']").prop("checked",!0)}else"pplPicker"===i?m(l.results||[l],n):"lookup"===i?U("lookup set elsewhere"):"multiText"===i?a.find("textarea").val(l):"multiTextEnhanced"===i&&a.find(".edit-content").html(l)}else if(o=t(this).attr("data-internal-fieldName"),u=t(".spLabel[data-internal-fieldName='"+o+"']"),2==(c=Number(u.attr("data-fieldTypeKind")))||3==c||6==c)t(this).html(d[o]);else if(4==c&&d[o])t(this).html(b(g(d[o])));else if(8==c)d[o]?t(this).html("Yes"):t(this).html("No");else if(15==c)t(this).html(d[o].results);else if((7==c||20==c)&&(l=d[o])){if(l.results){r=l.results,s="";for(var p=0;p<r.length;p++)s+=r[p].Title+"; "}else l.Title&&(s=l.Title);t(this).html(s)}})},L=function(){t("[data-default]").each(function(e,a){var i=t(this).attr("data-default");if(i){var n=t(this).attr("name");"single"===n?t(this).find("input").val(i):"radioButtons"===n?t(this).find("input[value='"+i+"']").prop("checked",!0):"dropdown"===n?t(this).find("select").val(i):"dateTime"==n?t(this).find("input").val(b(new Date)):"boolean"===n?t(this).find("input").prop("checked",!0):"checkBoxes"===n&&t(this).find("input[value='"+i+"']").prop("checked",!0)}})},j=function(e){var a="title='"+e.Title+"'",i="",n=e.DefaultValue||"";if(2===e.FieldTypeKind)return i+="<span class='customField' data-required='"+e.Required+"' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='single' data-Title='"+e.Title+"'><input class='form-control' type='text' "+a+"/></span>";if(3===e.FieldTypeKind)return"TRUE"==e.jsonS.Field["@attributes"].RichText?"<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='multiTextEnhanced' data-Title='"+e.Title+"'><div class='ms-rtestate-field ms-rtefield ms-inputBox' id='"+e.InternalName+"Multi_"+e.Id+"_$TextField_topDiv'><div id='"+e.InternalName+"_"+e.Id+"_$TextField_inplacerte_label' style='display: none;'>Rich text editor "+e.InternalName+"</div><div class='ms-rtestate-write ms-rteflags-0 ms-rtestate-field' id='"+e.InternalName+"_"+e.Id+"_$TextField_inplacerte' role='textbox' aria-haspopup='true' aria-labelledby='"+e.InternalName+"_"+e.Id+"_$TextField_inplacerte_label' style='min-height: 84px;' contenteditable='true' aria-autocomplete='both' aria-multiline='true' RteDirty='false'><p></p></div></span>":i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='multiText' data-Title='"+e.Title+"'><textarea class='form-control' "+a+" /></span>";if(4===e.FieldTypeKind)return i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='dateTime' data-Title='"+e.Title+"'><input type='text' id='"+e.InternalName+"' field-type='DateTime' "+a+"></span>";if(6===e.FieldTypeKind)return"RadioButtons"==e.jsonS.Field["@attributes"].Format?(i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='radioButtons' data-Title='"+e.Title+"'><div title="+e.Title+">",t.each(e.jsonS.Field.CHOICES.CHOICE,function(t,a){i+="<div class='radio-inline'><label><input type='radio' name='"+e.Title+"' id='optionsRadios1' value='"+a["#text"]+"'>"+a["#text"]+"</label></div>"}),i+="</div></span>"):(i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='dropdown' data-Title='"+e.Title+"'><select title="+e.Title+" class='form-control'>",t.each(e.jsonS.Field.CHOICES.CHOICE,function(t,e){i+="<option value='"+e["#text"]+"'>"+e["#text"]+"</option>"}),i+="</select></span>"),i;if(8===e.FieldTypeKind)return i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' name='boolean' data-internal='"+e.InternalName+"' data-default='"+n+"' data-Title='"+e.Title+"'><div class='checkbox'><label><input type='checkbox' "+a+"/></label></div></span>";if(9===e.FieldTypeKind||10===e.FieldTypeKind)return i+="<span class='customField' data-required='"+e.Required+"' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"' data-default='"+n+"' name='number' data-Title='"+e.Title+"'><input class='form-control' type='number' "+a+" "+q(e.MaximumValue,e.MinimumValue)+"/></span>";if(15===e.FieldTypeKind)return i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' name='checkBoxes' data-internal='"+e.InternalName+"' data-default='"+n+"' data-Title='"+e.Title+"'><div title='"+e.Title+"' class='checkBoxes'>",t.each(e.jsonS.Field.CHOICES.CHOICE,function(t,e){i+="<div class='checkbox-inline'><label><input type='checkbox' value='"+e["#text"]+"'>"+e["#text"]+"</label></div>"}),i+="</div></span>";if(20===e.FieldTypeKind)return i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"Id'  name='pplPicker' data-Title='"+e.Title+"'><div id='"+e.Title+"' class='ppl' "+a+" /></span>";if(7===e.FieldTypeKind){var l=e.LookupList;return l=l.substring(1,l.length-1),i+="<span data-required='"+e.Required+"' class='customField' data-kind='"+e.TypeAsString+"' data-internal='"+e.InternalName+"Id'  name='lookup' class='lookup' data-lookupList='"+l+"' data-lookupField='"+e.LookupField+"' data-allowMultipleValues='"+e.AllowMultipleValues+"' data-Title='"+e.Title+"'><div id='"+e.Title+"'  /></span><span class='textValue'></span>"}return""},q=function(t,e){var a=Number(t),i=Number(e);return a<1e12&&i>-1e12?"max='"+a+"' min='"+i+"'":""},O=function(t){var e={};if(1==t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var a=0;a<t.attributes.length;a++){var i=t.attributes.item(a);e["@attributes"][i.nodeName]=i.nodeValue}}}else 3==t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var n=0;n<t.childNodes.length;n++){var l=t.childNodes.item(n),d=l.nodeName;if(void 0===e[d])e[d]=O(l);else{if(void 0===e[d].push){var r=e[d];e[d]=[],e[d].push(r)}e[d].push(O(l))}}return e},U=function(t){_spPageContextInfo.userId===c.adminId&&console.log(t)},M=function(t){_spPageContextInfo.userId===c.adminId&&console.dir(t)},B=function(){var e=c.web+"/_api/web/Lists(guid'"+c.listGuid+"')/Fields",a=c.web+"/_api/web/Lists(guid'"+c.listGuid+"')/Views?&$filter=DefaultView%20eq%20true",i=c.scriptFolder+"html/modal.html",n=[],s=c.web+"/_api/web/Lists(guid'"+c.listGuid+"')/";c.itemId&&(s+="items("+c.itemId+")"),c.htmlUrl&&n.push(t.get(c.htmlUrl).done(function(t){c.htmlData=t}).fail(function(t){U("we failed to get the html "+JSON.stringify(t))})),n.push(t.get(i).done(function(t){c.modalHtml=t}).fail(function(t){U("we failed to get the html "+JSON.stringify(t))})),x(e).done(function(e){l=e.d.results;var i="",u="";c.itemId&&(i="&$select=*,AttachmentFiles,",u="&$expand=AttachmentFiles,"),t.each(l,function(e,a){if(!(a.Hidden||a.ReadOnlyField||7!=a.FieldTypeKind&&20!=a.FieldTypeKind)&&(c.itemId&&20==a.FieldTypeKind&&(i+=a.InternalName+"/Title,"+a.InternalName+"/Id,",u+=a.InternalName+"/Id,"),7==a.FieldTypeKind&&(c.itemId&&(i+=a.InternalName+"/"+a.LookupField+","+a.InternalName+"/Id,",u+=a.InternalName+"/Id,"),c.isEditForm))){var l=a.LookupList;l=l.substring(1,l.length-1),n.push(t.ajax({url:c.web+"/_api/web/Lists(guid'"+l+"')/items?&$top=5000&$select=Id,"+a.LookupField,type:"GET",listGuid:l,dataType:"json",headers:{Accept:"application/json;odata=verbose"},success:function(t){o[this.listGuid]=t.d},fail:function(t){U("fail list lookup "+this.listGuid+" "+JSON.stringify(t))}}))}}),i&&c.itemId&&(i=i.substring(0,i.length-1),u=u.substring(0,u.length-1),s+="?"+i+u),n.push(x(s).done(function(t){U("list done"),d=t.d,M(d),c.itemId?r=d.__metadata.type:(d=t.d,r=d.ListItemEntityTypeFullName)}).fail(function(t){U("fail fieldData"),M(t)})),n.push(x(a).done(function(t){c.goHereAfterSave=t.d.results[0].ServerRelativeUrl,U("view url "+t.d.results[0].ServerRelativeUrl)}).fail(function(t){U("fail viewUlr"),M(t)})),t.when.apply(t,n).then(function(){U("deferred done lookupListData"),M(o),k()}).fail(function(){U("we failed in first apply")})}).fail(function(t){U("fail fieldData"),M(t)})};c.scriptFolder&&c.listGuid?function(){var a,i=t("head");t("#getCustomForm").attr("src").split("getCustomForm")[0];c.removeBoostrapCSS&&t("link[title='bootstrap']").prop("disabled",!0),c.cssUrl&&i.append('<link rel="stylesheet" href="'+c.cssUrl+'" type="text/css" />'),c.jsUrl&&i.append('<script src="'+c.jsUrl+'"/><\/script>'),a=setInterval(function(){/loaded|complete/.test(e.readyState)&&(clearInterval(a),B())},10)}():alert("You need to supply the script folder and a list guid in 'settings.'")}}(jQuery,document,window);